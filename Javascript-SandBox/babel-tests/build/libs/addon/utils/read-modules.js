// jscs:disable
/* global requirejs, require */
/*jslint node: true */
// jscs:enable
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (prefix) {
  var modules = ['factories', 'fixtures', 'scenarios', 'models', 'serializers'];
  var mirageModuleRegExp = new RegExp('^' + prefix + '/mirage/(' + modules.join('|') + ')');
  var modulesMap = modules.reduce(function (memo, name) {
    memo[name] = {};
    return memo;
  }, {});

  (0, _keys3.default)(requirejs.entries).filter(function (key) {
    return mirageModuleRegExp.test(key);
  }).forEach(function (moduleName) {
    if (moduleName.match('.jshint')) {
      // ignore autogenerated .jshint files
      return;
    }
    var moduleParts = moduleName.split('/');
    var moduleType = moduleParts[moduleParts.length - 2];
    var moduleKey = moduleParts[moduleParts.length - 1];
    _ember2.default.assert('Subdirectories under i' + moduleType + ' are not supported', moduleParts[moduleParts.length - 3] === 'mirage');

    if (moduleType === 'scenario') {
      _ember2.default.assert('Only scenario/default.js is supported at this time.', moduleKey !== 'default');
    }

    /*
      Ensure fixture keys are pluralized
    */
    if (moduleType === 'fixtures') {
      moduleKey = (0, _inflector.pluralize)(moduleKey);
    }

    var module = require(moduleName, null, null, true);
    if (!module) {
      throw new Error(moduleName + ' must export a ' + moduleType);
    }

    var data = module['default'];

    modulesMap[moduleType][(0, _camelCase3.default)(moduleKey)] = data;
  });

  return modulesMap;
};

var _ember = require('ember');

var _ember2 = _interopRequireDefault(_ember);

var _keys2 = require('lodash/object/keys');

var _keys3 = _interopRequireDefault(_keys2);

var _camelCase2 = require('lodash/string/camelCase');

var _camelCase3 = _interopRequireDefault(_camelCase2);

var _inflector = require('ember-cli-mirage/utils/inflector');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }